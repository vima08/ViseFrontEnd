<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Vise</title>

        <link rel="stylesheet" type="text/css" href="css/component.css" />
        <script src="js/modernizr.custom.js"></script>

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">  <!-- Google web font "Open Sans" -->
        <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">                <!-- Font Awesome -->
        <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
        <link rel="stylesheet" type="text/css" href="slick/slick.css"/>
        <link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
        <link rel="stylesheet" type="text/css" href="css/datepicker.css"/>
        <link rel="stylesheet" href="css/tooplate-style.css">                                   <!-- Templatemo style -->

        <!--<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">-->

        <!--<script type="text/javascript" src="js/jquery.dataTables.js"></script>-->

        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <!--<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>-->
        <!--<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>-->
    </head>

    <body>
        <div class="tm-main-content" id="top">
            <div class="tm-top-bar-bg"></div>
            <div class="tm-top-bar" id="tm-top-bar">
                <!-- Top Navbar -->
                <div class="container">
                    <div class="row">

                        <nav class="navbar navbar-expand-lg navbar-light">
                            <a class="navbar-brand mr-auto" href="#">
                                <img src="img/logo.png" width="120" height="80" alt="Site logo">
                                Vise
                            </a>
                            <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                                <ul class="navbar-nav ml-auto">
                                  <li class="nav-item">
                                    <a class="nav-link" href="#top">Home <span class="sr-only">(current)</span></a>
                                  </li>
                                  <!--<li class="nav-item">-->
                                    <!--<a class="nav-link" href="#tm-section-4">History</a>-->
                                  <!--</li>-->
                                  <!--<li class="nav-item">-->
                                    <!--<a class="nav-link" href="#tm-section-6">Contact Us</a>-->
                                  <!--</li>-->
                                </ul>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
            <div class="tm-section tm-bg-img" id="tm-section-1">
                <div class="tm-bg-white ie-container-width-fix-2">
                    <div class="container ie-h-align-center-fix">
                        <div class="row">
                            <div class="col-xs-12 ml-auto mr-auto ie-container-width-fix">

                                <form action="javascript:void(null);" method="get" id="formx" class="tm-search-form tm-section-pad-2" onsubmit="call()">
                                    <div class="form-row tm-search-form-row">
                                        <div class="form-group tm-form-element tm-form-element-2">
                                            <select name="formSelect" class="form-control" id="formSelect">
                                                <option value="SimpleEgo">SimpleEgo</option>
                                                <option value="Combined">Combined</option>
                                            </select>
                                        </div>
                                        <div class="form-group tm-form-element tm-form-element-2">
                                            <button id="formSelectButton" class="btn btn-primary tm-btn-search">Select Experiment</button>
                                        </div>
                                        <!--<div class="form-group tm-form-element tm-form-element-2">-->
                                            <!--<button id="testButton" class="btn btn-primary tm-btn-search">TEST</button>-->
                                        <!--</div>-->
                                    </div>
                                    <div class="form-row tm-search-form-row" id="inputsdiv"></div>
                                    <div class="form-row tm-search-form-row" id="changeinputsdiv"></div>
                                    <div class="form-group tm-form-element tm-form-element-2">
                                        <!--<button type="submit" id="submitbutton" class="btn btn-primary tm-btn-search">Start Experiment</button>-->
                                    </div>
                                    <div>
                                        <div id="buttons1">
                                            <!--<div class="form-row tm-search-form-row" id="buttons">-->
                                            <div id="runButtonDiv1">
                                                <button type="submit" id="runButton1" class="btn btn-primary tm-btn-search">Run</button>
                                            </div>
                                            <div id="progress1">

                                                <div id="bar1">
                                                    <div id="barPercent1">0%</div>
                                                </div>
                                            </div>
                                            <div id="showResultButtonDiv1">
                                                <button type="submit" id="showResultButton1" disabled="true" class="btn btn-primary tm-btn-search">Show Result</button>
                                            </div>
                                            <div id="saveResultButtonDiv1">
                                                <button type="submit" id="saveResultButton1" disabled="true" class="btn btn-primary tm-btn-search">Save Result</button>
                                            </div>
                                        </div>
                                        <div id="buttons2">
                                            <!--<div class="form-row tm-search-form-row" id="buttons">-->
                                            <div id="runButtonDiv2">
                                                <button type="submit" id="runButton2" class="btn btn-primary tm-btn-search">Run</button>
                                            </div>
                                            <div id="progress2">
                                                <div id="bar2">
                                                    <div id="barPercent2">0%</div>
                                                </div>
                                            </div>
                                            <div id="showResultButtonDiv2">
                                                <button type="submit" id="showResultButton2" disabled="true" class="btn btn-primary tm-btn-search">Show Result</button>
                                            </div>
                                            <div id="saveResultButtonDiv2">
                                                <button type="submit" id="saveResultButton2" disabled="true" class="btn btn-primary tm-btn-search">Save Result</button>
                                            </div>
                                        </div>
                                        <div id="buttons3">
                                            <!--<div class="form-row tm-search-form-row" id="buttons">-->
                                            <div id="runButtonDiv3">
                                                <button type="submit" id="runButton3" class="btn btn-primary tm-btn-search">Run</button>
                                            </div>
                                            <div id="progress3">
                                                <div id="bar3">
                                                    <div id="barPercent3">0%</div>
                                                </div>
                                            </div>
                                            <div id="showResultButtonDiv3">
                                                <button type="submit" id="showResultButton3" disabled="true" class="btn btn-primary tm-btn-search">Show Result</button>
                                            </div>
                                            <div id="saveResultButtonDiv3">
                                                <button type="submit" id="saveResultButton3" disabled="true" class="btn btn-primary tm-btn-search">Save Result</button>
                                            </div>
                                        </div>
                                        <div id="buttons4">
                                            <!--<div class="form-row tm-search-form-row" id="buttons">-->
                                            <div id="runButtonDiv4">
                                                <button type="submit" id="runButton4" class="btn btn-primary tm-btn-search">Run</button>
                                            </div>
                                            <div id="progress4">
                                                <div id="bar4">
                                                    <div id="barPercent4">0%</div>
                                                </div>
                                            </div>
                                            <div id="showResultButtonDiv4">
                                                <button type="submit" id="showResultButton4" disabled="true" class="btn btn-primary tm-btn-search">Show Result</button>
                                            </div>
                                            <div id="saveResultButtonDiv4">
                                                <button type="submit" id="saveResultButton4" disabled="true" class="btn btn-primary tm-btn-search">Save Result</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <form id="hiddenForm"></form>

            <style>
                :root {
                    --step: 5%;
                    --button-width: 15%;
                    --runButton-left: 0%;
                    --progressBar-width: 40%;
                    --progressBar-height: 40px;
                    --progressBar-left: 20%;
                    --showResultButton-left:65%;
                    --saveResultButton-left: 85%;
                }
                #buttons1, #buttons2, #buttons3, #buttons4 {
                    position: relative;
                    height: 60px;
                    /*background-color: #7a95dd;*/
                }
                #runButtonDiv1, #runButtonDiv2, #runButtonDiv3, #runButtonDiv4 {
                    position: absolute;
                    left: var(--runButton-left);
                    width: var(--button-width);
                }
                #progress1, #progress2, #progress3, #progress4 {
                    position: absolute;
                    height: var(--progressBar-height);
                    left: var(--progressBar-left);
                    width: var(--progressBar-width);
                    background-color: #ddd;
                    text-align: center;
                    line-height: 30px;
                    color: white;
                }
                #bar1, #bar2, #bar3, #bar4 {
                    /*position: absolute;*/
                    width: 1%;
                    height: var(--progressBar-height);
                    text-align: center;
                    line-height: 30px;
                    color: white;
                    background-color: #4CAF50;
                }
                #barPercent, #barPercent1, #barPercent2, #barPercent3, #barPercent4 {
                    position: absolute;
                    left: 0%;
                    /*width: var(--progressBar-width);*/
                    width: 100%;
                    height: var(--progressBar-height);
                    text-align: center;
                    line-height: 35px;
                    color: black;
                    /*background-color: #0002af;*/
                }
                #showResultButtonDiv1, #showResultButtonDiv2, #showResultButtonDiv3, #showResultButtonDiv4 {
                    position: absolute;
                    left: var(--showResultButton-left);
                    width: var(--button-width);
                }
                #saveResultButtonDiv1, #saveResultButtonDiv2, #saveResultButtonDiv3, #saveResultButtonDiv4 {
                    position: absolute;
                    left: var(--saveResultButton-left);
                    width: var(--button-width);
                }
            </style>

            <footer class="tm-bg-dark-blue">
                <div class="container">
                    <div class="row">
                        <p class="col-sm-12 text-center tm-font-light tm-color-white p-4 tm-margin-b-0">
                        Copyright &copy; <span class="tm-current-year">2018</span> Your Company

                        - Designed by <a href="http://www.tooplate.com" class="tm-color-primary tm-font-normal" target="_parent">Tooplate</a></p>
                    </div>
                </div>
            </footer>
        </div>
        <!-- load JS files -->
        <script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
        <script src="js/popper.min.js"></script>                    <!-- https://popper.js.org/ -->
        <script src="js/bootstrap.min.js"></script>                 <!-- https://getbootstrap.com/ -->
        <script src="js/datepicker.min.js"></script>                <!-- https://github.com/qodesmith/datepicker -->
        <script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
        <script src="slick/slick.min.js"></script>                  <!-- http://kenwheeler.github.io/slick/ -->
        <script src="js/plotly-latest.min.js"></script>
        <!--<script src="js/button.js"></script>-->
        <script src="js/jquery-3.3.1.js"></script>
        <script src="js/jquery.serializeObject.js"></script>

        <!--<script>-->
            <!--$('#testButton').click(function () {-->
                <!--var msg = $('#formx').serialize();-->
                <!--$.ajax({-->
                    <!--type: 'GET',-->
                    <!--url: 'http://localhost:8080/ViseFrontEnd_war_exploded/resource/experiment/test',-->
                    <!--data: msg,-->
                    <!--success: function (data) {-->
                        <!--alert(data);-->

                    <!--},-->
                    <!--error: function (xhr, str) {-->
                        <!--alert('Возникла ошибка: ' + xhr.responseCode);-->
                        <!--alert(msg);-->
                    <!--}//,-->
                    <!--//dataType: "json"-->
                <!--});-->
            <!--});-->
        <!--</script>-->

        <script>
            var formFilesLocation = "D:\\Repository\\java vise\\ViseFrontEnd\\forms\\";
            var csvLocation = "D:\\Repository\\java vise\\ViseFrontEnd\\out\\artifacts\\ViseFrontEnd_war_exploded\\";
            //            var formFilesLocation = "/Users/maksimovvladislav/IdeaProjects/ViseFrontEnd/forms/";
            //            var csvLocation = "/Users/maksimovvladislav/IdeaProjects/ViseFrontEnd/out/artifacts/ViseFrontEnd_war_exploded/";
        </script>

        <script>
            var appendStringAddGroup = "";
            $('#formSelectButton').click(function () {
                var msg = "formFileName=" + formFilesLocation + $('#formSelect').val() + ".json";
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:8080/ViseFrontEnd_war_exploded/resource/formbuilder/form',
                    data: msg,
                    success: function(data) {
                        $('#inputsdiv').empty();
                        var i, j;
                        var appendString;
//                        alert(data);
                        for (i = 0; i < data.length; i++) {
                            appendString = "";
                            if (data[i].inputType == "select") {
//                                alert(data[i].options[1]);
                                appendString = "<div class=\"form-group tm-form-element tm-form-element-100\">\n" +
                                    "<i class=\"fa mt-1 tm-font-semibold tm-color-primary\">" + data[i].label + "</i>\n";
                                appendString += "<i class=\"fa fa-var-marker fa-2x tm-form-element-icon-my\"></i>\n" +
                                    "<select name=\"" + data[i].name + "\" class=\"form-control\" id=\"" + data[i].id +
                                    "\" attr_id=\"" + data[i].attr_id + "\" value=\"0.5\" >\n";
                                var options = data[i].options.split(",");
                                for (var j = 0; j < options.length; j++) {
                                    appendString += "<option value=\"" + options[j] + "\">" + options[j] + "</option>\n";
                                }
                                appendString += "</select>\n" + "</div>";
//                                alert(appendString);
                            } else if (data[i].inputType != "arrays"){
                                appendString = "<div class=\"form-group tm-form-element tm-form-element-100\">\n" +
                                    "<i class=\"fa mt-1 tm-font-semibold tm-color-primary\">" + data[i].label + "</i>\n" +
                                    "<i class=\"fa fa-";

                                appendString += "var-marker fa-2x tm-form-element-icon-my\"></i>\n" +
                                    "<input name=\"" + data[i].name +
                                    "\" type=\"" + data[i].type +
                                    "\" class=\"form-control\" id=\"" + data[i].id + "\"" +
                                    "placeholder=\"" + data[i].placeholder + "\" value=\"" + data[i].value + "\">\n" +
                                    "</div>";
                            }
                            $('#inputsdiv').append(appendString);

                            if (data[i].inputType == "arrays") {
//                                appendString = "<div class=\"form-group tm-form-element tm-form-element-2\">";
                                appendString = "<div class=\"form-row tm-search-form-row\">\n";
//                                alert(data[i].inputs.length);
                                for (j = 0; j < data[i].inputs.length; j++) {
                                    appendString += "<div class=\"form-group tm-form-element tm-form-element-100\">\n" +
                                        "<i class=\"fa mt-1 tm-font-semibold tm-color-primary\">" + data[i].inputs[j].label + "</i>\n" +
                                        "<i class=\"fa fa-";

                                    appendString += "var-marker fa-2x tm-form-element-icon-my\"></i>\n" +
                                        "<input name=\"" + data[i].inputs[j].name +
                                        "\" type=\"" + data[i].inputs[j].type +
                                        "\" class=\"form-control\" id=\"" + data[i].id + "\"" +
                                        "placeholder=\"" + data[i].inputs[j].placeholder + "\" value=\"" + data[i].inputs[j].value + "\">\n" +
                                        "</div>";
                                }
                                appendString += "</div>";
                                appendStringAddGroup = appendString;
                                $('#changeinputsdiv').append(appendString);
                                appendString = "<div class=\"form-group tm-form-element tm-form-element-100\">\n" +
                                    "<i class=\"fa mt-1 tm-font-semibold tm-color-primary\">Add group</i>\n" +
                                    "<button id=\"addGroupButton\" class=\"btn btn-primary tm-btn-search\" " +
                                    "onclick='addGroup()'>Add Group</button>\n" +
                                    "</div>";
                                $('#inputsdiv').append(appendString);
//                                appendString += "<button id=\"addGroupButton\" class=\"btn btn-primary tm-btn-search\">Add Group</button>\n";
//                                appendString += "</div>";

                            }
                        }

                    },
                    error: function(xhr, str){
                        alert('Возникла ошибка (form builder): ' + xhr.responseCode);
                    },
                    dataType: "json"
                })

            });
            $('#testButton').click(function () {
                alert("sdvd");
                alert(appendStringAddGroup);
                $('#changeinputsdiv').append(appendStringAddGroup);
            });
            function addGroup() {
//                alert("sdfavge");
                $('#changeinputsdiv').append(appendStringAddGroup);
            }
        </script>

         <script>
             function showResult(experimentNumber) {
                 sessionStorage.setItem("resultToDraw", 'result=' + JSON.stringify(results[experimentNumber]) + '&' + params[experimentNumber]);
                 window.open(
                     'http://localhost:8080/ViseFrontEnd_war_exploded/CSS%20HTML%20Template/result.html?',
                     '_blank'
                 );
             }
             var csvdata;
             var params = new Array(4);
             var results = new Array(4);
             var inProgress = [false, false, false, false];
             $('#runButton1').click(function () {
                 var date = new Date();
                 var experimentId = date.getTime();
                 inProgress[0] = true;
                 callPercentage(experimentId, "bar1", 1);
                 runExperiment(experimentId, 1);
                 disactivateButtons(1);
             });
             $('#runButton2').click(function () {
                 var date = new Date();
                 var experimentId = date.getTime();
                 inProgress[1] = true;
                 callPercentage(experimentId, "bar2", 2);
                 runExperiment(experimentId, 2);
                 disactivateButtons(2);
             });
             $('#runButton3').click(function () {
                 var date = new Date();
                 var experimentId = date.getTime();
                 inProgress[2] = true;
                 callPercentage(experimentId, "bar3", 3);
                 runExperiment(experimentId, 3);
                 disactivateButtons(3);
             });
             $('#runButton4').click(function () {
                 var date = new Date();
                 var experimentId = date.getTime();
                 inProgress[3] = true;
                 callPercentage(experimentId, "bar4", 4);
                 runExperiment(experimentId, 4);
                 disactivateButtons(4);
             });
             $('#showResultButton1').click(function() {
//                 window.open(
//                     'http://localhost:8080/ViseFrontEnd_war_exploded/CSS%20HTML%20Template/result.html?' +
//                     'result=' + JSON.stringify(results[0]) + '&' + params[0],
//                     '_blank'
//                 );
//                 sessionStorage.setItem("resultToDraw", 'result=' + JSON.stringify(results[0]) + '&' + params[0]);
//                 window.open(
//                     'http://localhost:8080/ViseFrontEnd_war_exploded/CSS%20HTML%20Template/result.html?',
//                     '_blank'
//                 );
                 //showResult(JSON.stringify(results[0]) + '&' + params[0]);
                 showResult(0);
             });
             $('#showResultButton2').click(function() {
                 showResult(1);
             });
             $('#showResultButton3').click(function() {
                 showResult(2);
             });
             $('#showResultButton4').click(function() {
                 showResult(3);
             });
             $('#saveResultButton1').click(function() {
                 saveTextAsFile("data_for_csv=" + JSON.stringify(results[0]));
             });
             $('#saveResultButton2').click(function() {
                 saveTextAsFile("data_for_csv=" + JSON.stringify(results[1]));
             });
             $('#saveResultButton3').click(function() {
                 saveTextAsFile("data_for_csv=" + JSON.stringify(results[2]));
             });
             $('#saveResultButton4').click(function() {
                 saveTextAsFile("data_for_csv=" + JSON.stringify(results[3]));
             });
        </script>

        <script>
            function callPercentage(experimentId, progressBarId, experimentNumber) {
                var elem = document.getElementById(progressBarId);
                var id = setInterval(frame, 100);
                var reset = 0;
                function frame() {
                    $.ajax({
                        type: 'GET',
                        data: "experimentId=" + experimentId,
                        url: 'http://localhost:8080/ViseFrontEnd_war_exploded/resource/experiment/percentage',
                        success: function(data) {
                            elem.style.width = data * 100 + '%';
//                            elem.innerHTML = Math.round(data * 100) + '%';
                            elem.innerHTML = "<div id=\"barPercent\">" + Math.round(data * 100) + '%' + "</div>";

                            if (data >= 1) reset++;
//                            if (reset >= 5) {
                            if (!inProgress[experimentNumber - 1]) {
//                                elem.style.width = 1 + '%';
                                clearInterval(id);
                                reset = 0;
                            }
                            //$('#results').html(data);
                        },
                        error:  function(xhr, str){
                            alert('Возникла ошибка: ' + xhr.responseCode);
                        },
                        dataType: "json"
                    });
                }
            }
            function runExperiment(experimentId, experimentNumber) {
                var msg = $('#formx').serialize();
                msg += "&experimentId=" + experimentId;
//                msg += "&formSelect=" + $('#formSelect').val();
                params[experimentNumber - 1] = msg;
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:8080/ViseFrontEnd_war_exploded/resource/experiment/run',
                    data: msg,
                    success: function (data) {
                        results[experimentNumber - 1] = data;
//                        drawResult(data);
                        inProgress[experimentNumber - 1] = false;
                        activateButtons(experimentNumber);

                    },
                    error: function (xhr, str) {
                        inProgress[experimentNumber - 1] = false;
                        alert('Возникла ошибка: ' + xhr.responseCode);
                        alert(msg);
                    },
                    dataType: "json"
                });
            }
            function disactivateButtons(number) {
                document.getElementById('showResultButton' + number).disabled = true;
                document.getElementById('saveResultButton' + number).disabled = true;
            }
            function activateButtons(number) {
                document.getElementById('showResultButton' + number).disabled = false;
                document.getElementById('saveResultButton' + number).disabled = false;
            }
        </script>

        <script type="text/javascript">
            function saveTextAsFile(data_for_csv) {
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:8080/ViseFrontEnd_war_exploded/resource/csv/saveCSV',
                    data: data_for_csv + "&csvUrl=" + csvLocation,
                    success: function (name) {
                        var fileNameToSaveAs = name;

                        var downloadLink = document.createElement("a");
                        downloadLink.download = fileNameToSaveAs;
                        downloadLink.innerHTML = "Download File";
                        downloadLink.href =  "http://localhost:8080/ViseFrontEnd_war_exploded/" + name;
                        downloadLink.onclick = destroyClickedElement;
                        downloadLink.style.display = "none";
                        document.body.appendChild(downloadLink);

                        downloadLink.click();
                    },
                    error: function (xhr, str) {
                        alert('Возникла ошибка: ' + data_for_csv);
                    },
                    dataType: "text"
                });
            }
            function destroyClickedElement(event) {
                document.body.removeChild(event.target);
            }
        </script>


        <script>
            function serialize() {
                var data = {};
                $("[attr_id]").each(function () {
                    data[$(this).attr("attr_id")] = $(this).val()
                });
                return data;
            }
        </script>


    </body>
</html>

